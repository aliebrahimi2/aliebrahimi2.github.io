<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>بازیابی رمز عبور | علی ابراهیمی</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="auth.css">
   <!-- آیکون‌های اصلی برای مرورگرها -->
<link rel="icon" type="image/png" sizes="32x32" href="./asli.png">
<link rel="icon" type="image/png" sizes="16x16" href="./asli.png">
<link rel="shortcut icon" href="./asli.png">
    <meta name="robots" content="noindex, nofollow">

<!-- برای دستگاه‌های اپل (آیکون وقتی سایت رو به صفحه اصلی اضافه می‌کنن) -->
<link rel="apple-touch-icon" sizes="180x180" href="./asli.png">

<!-- اگه مرورگر از webmanifest پشتیبانی می‌کنه (اختیاری) -->
<link rel="manifest" href="./asli.png">
</head>
<body class="auth-page">
    <a href="index.html" class="back-to-home"><i class="fas fa-arrow-right"></i> بازگشت به صفحه اصلی</a>
    <div class="auth-container">
        <div class="auth-wrapper">
            <div class="auth-left">
                <div class="auth-content">
                    <a href="index.html" class="auth-logo"><span class="logo-text">علی ابراهیمی</span></a>
                    <h1 class="auth-title">بازیابی رمز عبور</h1>
                    <p class="auth-subtitle">پاسخ امنیتی را وارد کنید و رمز جدید انتخاب کنید</p>
                    <form class="auth-form" id="forgotPasswordForm">
                        <div class="form-group">
                            <label for="email">ایمیل</label>
                            <div class="input-with-icon"><i class="fas fa-envelope"></i><input type="email" id="email" placeholder="example@email.com" required></div>
                            <div class="error-message" id="emailError"></div>
                        </div>
                        <div class="form-group">
                            <label for="securityAnswer">سوال امنیتی: نام مادر شما چیست؟</label>
                            <div class="input-with-icon"><i class="fas fa-question-circle"></i><input type="text" id="securityAnswer" placeholder="پاسخ امنیتی" required></div>
                            <div class="error-message" id="securityAnswerError"></div>
                        </div>
                        <div class="form-group">
                            <label for="newPassword">رمز عبور جدید</label>
                            <div class="input-with-icon">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="newPassword" placeholder="حداقل ۸ کاراکتر" required>
                                <button type="button" class="toggle-password"><i class="fas fa-eye"></i></button>
                            </div>
                            <div class="error-message" id="newPasswordError"></div>
                        </div>
                        <div class="form-group">
                            <label for="confirmNewPassword">تکرار رمز عبور جدید</label>
                            <div class="input-with-icon">
                                <i class="fas fa-lock"></i>
                                <input type="password" id="confirmNewPassword" placeholder="تکرار رمز جدید" required>
                                <button type="button" class="toggle-password"><i class="fas fa-eye"></i></button>
                            </div>
                            <div class="error-message" id="confirmNewPasswordError"></div>
                        </div>
                        <button type="submit" class="btn btn-primary btn-auth">تغییر رمز عبور</button>
                        <div class="auth-divider"><span>یا</span></div>
                        <div class="auth-footer">
                            <p>رمز عبور خود را به خاطر آوردید؟ <a href="login.html">وارد شوید</a></p>
                            <p>حساب کاربری ندارید؟ <a href="signup.html">ثبت‌نام کنید</a></p>
                        </div>
                    </form>
                    <div class="password-reset-instructions"><h3>راهنمای بازیابی:</h3><ul><li>ایمیل خود را وارد کنید</li><li>پاسخ امنیتی که هنگام ثبت‌نام وارد کردید را بنویسید</li><li>رمز جدید انتخاب کنید</li></ul></div>
                </div>
            </div>
            <div class="auth-right">
                <div class="auth-hero">
                    <div class="auth-image"><img src="./6.jpg" alt="بازیابی رمز عبور"></div>
                    <div class="auth-hero-content"><h2>رمز عبور خود را فراموش کرده‌اید؟</h2><p>نگران نباشید! با پاسخ به سوال امنیتی می‌توانید رمز جدید تنظیم کنید.</p>
                        <div class="auth-features"><div class="feature"><i class="fas fa-shield-alt"></i><span>امنیت بالا</span></div><div class="feature"><i class="fas fa-bolt"></i><span>سریع و آسان</span></div><div class="feature"><i class="fas fa-check-circle"></i><span>تضمین موفقیت</span></div></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="auth-system.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('forgotPasswordForm');
            const emailInput = document.getElementById('email');
            const securityAnswerInput = document.getElementById('securityAnswer');
            const newPasswordInput = document.getElementById('newPassword');
            const confirmNewPasswordInput = document.getElementById('confirmNewPassword');
            const emailError = document.getElementById('emailError');
            const securityAnswerError = document.getElementById('securityAnswerError');
            const newPasswordError = document.getElementById('newPasswordError');
            const confirmNewPasswordError = document.getElementById('confirmNewPasswordError');

            document.querySelectorAll('.toggle-password').forEach(btn => {
                btn.addEventListener('click', function() {
                    const input = this.parentElement.querySelector('input');
                    const icon = this.querySelector('i');
                    if (input.type === 'password') {
                        input.type = 'text';
                        icon.classList.remove('fa-eye');
                        icon.classList.add('fa-eye-slash');
                    } else {
                        input.type = 'password';
                        icon.classList.remove('fa-eye-slash');
                        icon.classList.add('fa-eye');
                    }
                });
            });

            function validateEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            }
            function validatePassword(pwd) {
                return pwd.length >= 8;
            }

            emailInput.addEventListener('input', function() {
                if (!validateEmail(this.value)) {
                    emailError.textContent = 'ایمیل معتبر وارد کنید';
                    this.style.borderColor = '#e74c3c';
                } else {
                    emailError.textContent = '';
                    this.style.borderColor = '#ddd';
                }
            });
            securityAnswerInput.addEventListener('input', function() {
                if (!this.value.trim()) {
                    securityAnswerError.textContent = 'پاسخ را وارد کنید';
                    this.style.borderColor = '#e74c3c';
                } else {
                    securityAnswerError.textContent = '';
                    this.style.borderColor = '#ddd';
                }
            });
            newPasswordInput.addEventListener('input', function() {
                if (!validatePassword(this.value)) {
                    newPasswordError.textContent = 'حداقل ۸ کاراکتر';
                    this.style.borderColor = '#e74c3c';
                } else {
                    newPasswordError.textContent = '';
                    this.style.borderColor = '#ddd';
                }
                if (confirmNewPasswordInput.value && this.value !== confirmNewPasswordInput.value) {
                    confirmNewPasswordError.textContent = 'رمز عبور و تکرار یکسان نیستند';
                    confirmNewPasswordInput.style.borderColor = '#e74c3c';
                } else {
                    confirmNewPasswordError.textContent = '';
                    confirmNewPasswordInput.style.borderColor = '#ddd';
                }
            });
            confirmNewPasswordInput.addEventListener('input', function() {
                if (newPasswordInput.value !== this.value) {
                    confirmNewPasswordError.textContent = 'رمز عبور و تکرار یکسان نیستند';
                    this.style.borderColor = '#e74c3c';
                } else {
                    confirmNewPasswordError.textContent = '';
                    this.style.borderColor = '#ddd';
                }
            });

            form.addEventListener('submit', function(e) {
                e.preventDefault();
                const email = emailInput.value.trim();
                const answer = securityAnswerInput.value.trim();
                const newPass = newPasswordInput.value;
                const confirmNew = confirmNewPasswordInput.value;

                let valid = true;
                if (!validateEmail(email)) { emailError.textContent = 'ایمیل معتبر وارد کنید'; emailInput.style.borderColor = '#e74c3c'; valid = false; }
                if (!answer) { securityAnswerError.textContent = 'پاسخ را وارد کنید'; securityAnswerInput.style.borderColor = '#e74c3c'; valid = false; }
                if (!validatePassword(newPass)) { newPasswordError.textContent = 'حداقل ۸ کاراکتر'; newPasswordInput.style.borderColor = '#e74c3c'; valid = false; }
                if (newPass !== confirmNew) { confirmNewPasswordError.textContent = 'یکسان نیستند'; confirmNewPasswordInput.style.borderColor = '#e74c3c'; valid = false; }

                if (valid) {
                    const btn = form.querySelector('button[type="submit"]');
                    btn.disabled = true;
                    btn.textContent = 'در حال پردازش...';
                    const result = auth.forgotPassword(email, answer, newPass);
                    setTimeout(() => {
                        if (result.success) {
                            alert('رمز عبور با موفقیت تغییر کرد. اکنون وارد شوید.');
                            window.location.href = 'login.html';
                        } else {
                            alert(result.message);
                            btn.disabled = false;
                            btn.textContent = 'تغییر رمز عبور';
                        }
                    }, 1000);
                }
            });
        });
    </script>
</body>

</html>
